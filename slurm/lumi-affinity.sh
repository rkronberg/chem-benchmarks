SELECT_GPU="select_gpu_$SLURM_JOBID"

cat << EOF > $SELECT_GPU
#!/bin/bash

export ROCR_VISIBLE_DEVICES=\$((SLURM_LOCALID%SLURM_GPUS_PER_NODE))
exec \$*
EOF

chmod +x ./$SELECT_GPU

CPU_BIND="mask_cpu:fe000000000000,fe00000000000000"
CPU_BIND="${CPU_BIND},fe0000,fe000000"
CPU_BIND="${CPU_BIND},fe,fe00"
CPU_BIND="${CPU_BIND},fe00000000,fe0000000000"

SRUN_OPTS="--cpu-bind=$CPU_BIND ./$SELECT_GPU"
